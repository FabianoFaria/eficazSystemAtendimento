<?phpif (!function_exists("get_header"))	require_once("../../includes/functions.gerais.php");if (!function_exists("mpress_query"))	require_once("../../config.php");global $configLaboratorio;$configLaboratorio = carregarConfiguracoesGeraisModulos('laboratorio');function carregarHistoricoAnalise($labProdID){	$sql = "SELECT lpf.Laboratorio_Follow_ID, lpf.Status_ID, lpf.Descricao, lpf.Data_Cadastro, cd.Nome as Usuario, ts.Descr_Tipo as Situacao		FROM laboratorio_produtos_follows lpf		inner join tipo ts on ts.Tipo_ID = lpf.Status_ID		left join cadastros_dados cd on cd.Cadastro_ID = lpf.Usuario_Cadastro_ID		where lpf.Laboratorio_Produto_ID = '$labProdID'		order by lpf.Laboratorio_Follow_ID desc";	//echo $sql;	$query = mpress_query($sql);	$i=0;	while($rs = mpress_fetch_array($query)){		$i++;		$dados[colunas][conteudo][$i][1] = "<p Style='margin:2px 5px 0 5px;float:left;'>".nl2br($rs['Descricao'])."</p>";		$dados[colunas][conteudo][$i][2] = "<p Style='margin:2px 5px 0 5px;float:left;'>".$rs['Situacao']."</p>";		$dados[colunas][conteudo][$i][3] = "<p Style='margin:2px 5px 0 5px;float:left;'>".converteDataHora($rs['Data_Cadastro'],1)."</p>";		$dados[colunas][conteudo][$i][4] = "<p Style='margin:2px 5px 0 5px;float:left;'>".$rs['Usuario']."</p>";	}	$dados[colunas][titulo][1] 	= "Observa&ccedil;&otilde;es Cadastradas";	$dados[colunas][titulo][2] 	= "Situa&ccedil;&atilde;o";	$dados[colunas][titulo][3] 	= "Data";	$dados[colunas][titulo][4] 	= "Usu&aacute;rio";	$dados[colunas][tamanho][1] = "width=''";	$dados[colunas][tamanho][2] = "width='180px'";	$dados[colunas][tamanho][3] = "width='180px'";	$dados[colunas][tamanho][4] = "width='250px'";	geraTabela("100%", "4", $dados, '', 'laboratorio-follows', 2, 2, 10,'');}function salvarLaboratorioAnaliseMaterial(){	global $caminhoSistema, $dadosUserLogin;	$dataHoraAtual = "'".retornaDataHora('','Y-m-d H:i:s')."'";	$labProdID = $_POST['lab-prod-id'];	if ($labProdID!=""){		$labProdVariacaoID = $_POST['lab-produto-variacao-id'];		$labNumeroSerie = $_POST['lab-numero-serie'];		//$labDescricao = $_POST['lab-descricao'];		$labResponsavel = $_POST['lab-responsavel'];		$labStatus = $_POST['lab-status'];		$labObservacao = $_POST['lab-observacao'];		$labStatusAtual = $_POST['lab-status-atual'];		$labOrigemCadastroID = $_POST['lab-origem-cadastro-id'];		$cdID = $_POST['cd-id'];		if (($labStatusAtual == "132") || ($labStatusAtual == "133")){			mpress_query("INSERT INTO laboratorio_produtos_follows (Laboratorio_Produto_ID, Status_ID, Descricao, Data_Cadastro, Usuario_Cadastro_ID, Situacao_ID)														VALUES ('$labProdID', '$labStatusAtual', '$labObservacao', $dataHoraAtual,'".$dadosUserLogin['userID']."', 1)");		}		else{			if (($labStatus == "132") && ($labStatus == "133")){				$labDataFinalizado = converteDataHora($_POST['lab-data-finalizado']);				$camposExtras = ", Data_Finalizado = '$labDataFinalizado', Data_Finalizado = '$labDataFinalizado' ";			}			mpress_query("UPDATE laboratorio_produtos SET Status_ID = '$labStatus',							Tecnico_Responsavel_ID = '$labResponsavel',							/* Descricao = '$labDescricao', */							Origem_Cadastro_ID = '$labOrigemCadastroID'							".$camposExtras."							WHERE Laboratorio_Produto_ID = '$labProdID'");			mpress_query("INSERT INTO laboratorio_produtos_follows (Laboratorio_Produto_ID, Status_ID, Descricao, Data_Cadastro, Usuario_Cadastro_ID, Situacao_ID)														VALUES ('$labProdID', '$labStatus', '$labObservacao', $dataHoraAtual,'".$dadosUserLogin['userID']."', 1)");			/***********************/			/* METERIAL ARRUMADO */			/***********************/			if ($labStatus == "132"){				mpress_query("update produtos_movimentacoes set Situacao_ID = 1 where Produto_Movimentacao_ID in (Select lp.Produto_Movimentacao_ID from laboratorio_produtos lp where lp.Laboratorio_Produto_ID = '$labProdID')");				/* MOVIMENTACAO DE SAIDA DO LABORATORIO */				$sql = "insert into produtos_movimentacoes (Numero_Serie, CD_ID, Chave_Estrangeira, Chave_Estrangeira_Produto, Tabela_Estrangeira, Produto_Variacao_ID, Tipo_Movimentacao_ID, Quantidade, Nota_Fiscal, Data_Cadastro, Usuario_Cadastro_ID)														values ('$labNumeroSerie', -1, '$labProdID', 						  0,      'laboratorio', '$labProdVariacaoID',                '67',          -1,          '', $dataHoraAtual, '".$dadosUserLogin['userID']."')";				mpress_query($sql);				$dataHoraAtual = "'".retornaDataHora('','Y-m-d H:i:s')."'";				/* MOVIMENTACAO DE ENTRADA NO ESTOQUE ENCAMINHADO */				$sql = "insert into produtos_movimentacoes (Numero_Serie, CD_ID, Chave_Estrangeira, Chave_Estrangeira_Produto, Tabela_Estrangeira, Produto_Variacao_ID, Tipo_Movimentacao_ID, Quantidade, Nota_Fiscal, Data_Cadastro, Usuario_Cadastro_ID)														values ('$labNumeroSerie', '$cdID', '$labProdID', 						  0,      'laboratorio', '$labProdVariacaoID',                '66',          1,          '', $dataHoraAtual, '".$dadosUserLogin['userID']."')";				mpress_query($sql);			}			/***********************/			/* MATERIAL DESCARTADO */			/***********************/			if ($labStatus == "133"){				mpress_query("update produtos_movimentacoes set Situacao_ID = 2 where Produto_Movimentacao_ID in (Select lp.Produto_Movimentacao_ID from laboratorio_produtos lp where lp.Laboratorio_Produto_ID = '$labProdID')");				/* MOVIMENTACAO DE SAIDA DO LABORATORIO */				$sql = "insert into produtos_movimentacoes (Numero_Serie, CD_ID, Chave_Estrangeira, Chave_Estrangeira_Produto, Tabela_Estrangeira, Produto_Variacao_ID, Tipo_Movimentacao_ID, Quantidade, Nota_Fiscal, Data_Cadastro, Usuario_Cadastro_ID)														values ('$labNumeroSerie', -1, '$labProdID', 						  0,      'laboratorio', '$labProdVariacaoID',                '67',          -1,          '', $dataHoraAtual, '".$dadosUserLogin['userID']."')";				mpress_query($sql);			}		}		echo "	<form method='post' action='$caminhoSistema/laboratorio/laboratorio-material-analise' name='frmAuxiliar'>					<input type='hidden' id='lab-prod-id' name='lab-prod-id' value='$labProdID'>				</form>				<script>document.frmAuxiliar.submit();</script>";	}}function carregarMateriais($labProID, $tipo){	global $caminhoSistema;	$sqlCond = "";
	if ($tipo=='utilizados'){
		$sqlCond = " AND lp.Quantidade < 0";	}		
	if ($tipo=='recuperados'){
		$sqlCond = " AND lp.Quantidade > 0";
		$escondeRec = 'esconde';	}
	$sql = "SELECT lp.Laboratorio_Materia_Prima_ID, lp.Quantidade as Quantidade,				CONCAT(COALESCE(pd.Nome,''),' ', COALESCE(pv.Descricao,'')) AS Descricao_Material, lp.Data_Cadastro, r.Nome as Responsavel,				lp.Justificativa, lp.Status_ID, ts.Descr_Tipo as Status,				a.Nome as AprovadorReprovador, lp.Data_Alteracao as Data_Alteracao				FROM laboratorio_materia_prima lp				INNER JOIN produtos_variacoes pv ON pv.Produto_Variacao_ID = lp.Produto_Variacao_ID				INNER JOIN produtos_dados pd ON pd.Produto_ID = pv.Produto_ID				INNER JOIN cadastros_dados r on r.Cadastro_ID = lp.Usuario_Cadastro_ID				LEFT JOIN cadastros_dados a on a.Cadastro_ID = lp.Usuario_Alteracao_ID				LEFT JOIN tipo ts on ts.Tipo_ID = lp.Status_ID				WHERE lp.Laboratorio_Produto_ID = '$labProID'				AND lp.Situacao_ID = 1				".$sqlCond."
				ORDER BY lp.Data_Cadastro DESC";	//echo $sql;	$query = mpress_query($sql);	$i=0;	while($rs = mpress_fetch_array($query)){		$i++;		$nomeArquivo = $caminhoSistema."/images/geral/imagem-produto.jpg";		if ($rs['Nome_Arquivo']!=""){			$nomeArquivo = $caminhoSistema."/uploads/".$rs['Nome_Arquivo'];		}		$imagemProduto = "<a href='$nomeArquivo' class='fancybox' rel='fancybox'><img style='max-width:50px; max-height:50px' src='$nomeArquivo' align='center'/></a>";		$labMatPrimaID = $rs['Laboratorio_Materia_Prima_ID'];		echo "	<div class='bloco-prod-$labMatPrimaID'>					<fieldset style='min-height:70px; margin-top:10px;'>						<div style='float:left; width:100%'>
							<div style='float:left; width:10%' align='center'>								$imagemProduto							</div>							<div class='titulo-secundario' style='float:left; margin-left:2px; width:35%'>								<p><b>Material</b></p>								<p><input type='text' name='lab-mp[]' style='width:90%' readonly='readonly' value='".($rs['Descricao_Material'])."'/></p>							</div>							<div class='titulo-secundario'  style='width:10%;float:left;'>								<p><b>Quantidade</b></p>								<p><input type='text' style='width:90%' name='lab-qtde[]'readonly='readonly' value='".($rs['Quantidade'])."'/></p>							</div>							<div class='titulo-secundario' style='width:15%;float:left;'>								<p><b>Solicitante</b></p>								<p>".$rs['Responsavel']."</p>								<p>".converteDataHora($rs['Data_Cadastro'],1)."</p>							</div>							<div class='titulo-secundario' style='float:left; width:12%;' align='center'>";		if ($rs['Status_ID']=='176'){			echo "				<p><b><label for='imp-sol-$labMatPrimaID'>Imprimir</label></b></p>								<p><b><input type='checkbox' name='imp-sol[]' id='imp-sol-$labMatPrimaID' class='imp-sol' value='$labMatPrimaID'/></b></p>";		}		echo "				</div>							<div class='titulo-secundario' style='float:right; width:17%; ' align='center'>								<p><b>".$rs['Status']."</b></p>";		if ($rs['Status_ID']=='176'){			echo "			<div class='btn-excluir btn-excluir-material' style='float:right; padding-right:1px' alvo='bloco-prod-$labMatPrimaID' lab-mat-id='$labMatPrimaID' tipo='$tipo' title='Excluir'>&nbsp;</div>							<!--<div class='btn-editar btn-editar-material' style='float:right; padding-right:1px' alvo='bloco-prod-$labMatPrimaID' lab-mat-id='$labMatPrimaID' tipo='$tipo' title='Editar'>&nbsp;</div>-->";		}		else{			if ($rs['AprovadorReprovador']!=''){				echo "		<p>".$rs['AprovadorReprovador']."</p>";				echo "		<p>".converteDataHora($rs['Data_Alteracao'],1)."</p>";			}		}				echo "						</div>						<div style='float:left; width:100%' align='center'>&nbsp;</div>
						<div style='float:left; width:10%' align='center'>&nbsp;</div>
						<div class='titulo-secundario $escondeRec' style='float:left; width:45%;'>
							<p><b>Observa&ccedil;&atilde;o:</b></p>
							<p><input type='text' style='width:98%' name='lab-justificativa[]' readonly='readonly' value='".($rs['Justificativa'])."'/></p>
						</div>
						<input type='hidden' name='lab-data-sol[]' value='".converteDataHora($rs['Data_Cadastro'],1)."'/>						<input type='hidden' name='lab-solicitante[]' value='".$rs['Responsavel']."'/>					</fieldset>				</div>";	}	echo "	<input type='button' class='btn-imprimir-solicitacoes esconde' value='Imprimir Solicita&ccedil;&otilde;es' style='float:left; margin-left:71.5%; margin-top:10px;'/>";	if ($i==0){		echo "<p align='center'>Nenhuma material utilizado</p>";	}}function incluirAlterarMaterialLaboratorio(){	global $caminhoSistema;	$labMatID = $_GET['lab-mat-id'];	$alvo = $_GET['alvo'];
	$tipo = $_GET['tipo'];
	$textoBotaoIncAlt = "Incluir";	$quantidade = "1";	if ($labMatID!=''){		$sql = "SELECT Laboratorio_Materia_Prima_ID, Laboratorio_Produto_ID, Quantidade, Produto_Variacao_ID, Responsavel_ID, Descricao, Status_ID, Data_Cadastro, Usuario_Cadastro_ID, Situacao_ID					FROM laboratorio_materia_prima					where Laboratorio_Materia_Prima_ID = '$labMatID'";		$resultado = mpress_query($sql);		if ($rs = mpress_fetch_array($resultado)){			$selMP[$rs['Produto_Variacao_ID']] = " selected ";			$quantidade = number_format($rs['Quantidade'],0,"","");		}		$textoBotaoIncAlt = "Alterar";	}	$sql = "SELECT pv.Produto_Variacao_ID AS Produto_Variacao_ID, pv.Codigo AS Codigo_Variacao, pd.Codigo AS Codigo, CONCAT(COALESCE(pd.Nome,''),' ', COALESCE(pv.Descricao,'')) AS Descricao_Produto,				pv.Forma_Cobranca_ID, f.Descr_Tipo as Forma_Cobranca, case pv.Forma_Cobranca_ID when 35 then pv.Valor_Venda else '' end as Valor_Venda, pd.Produto_ID as Produto_ID				FROM produtos_dados pd				INNER JOIN produtos_variacoes pv ON pd.Produto_ID = pv.Produto_ID				inner join tipo f on f.Tipo_ID = pv.Forma_Cobranca_ID				WHERE pd.Situacao_ID = 1 AND pv.Situacao_ID = 1 AND pd.Produto_ID > 0 AND pv.Produto_Variacao_ID > 0 and pd.Tipo_Produto in (175,30) and pd.Numero_Serie = 0			ORDER BY Descricao_Produto";	//echo $sql;	$selectProdutos = "";	$resultado = mpress_query($sql);	while($row = mpress_fetch_array($resultado)){		$selectProdutos .= "<option value='".$row['Produto_Variacao_ID']."' ".$selMP[$row['Produto_Variacao_ID']].">".utf8_encode($row['Descricao_Produto'])."</option>";	}	echo "	<div id='bloco-altera-inclui-mp'>				<fieldset style='min-height:70px; margin-top:10px;'>					<div class='titulo-secundario' id='div-produtos-select' style='float:left; width:50%;'>						<p><b>Selecione o Material</b></p>						<p>							<select id='select-materia-prima' name='select-materia-prima' class='required select-materia-prima' Style='width:98.5%' data-placeholder='Selecione' tipo='$tipo'>								<option value='' produto-id=''>Selecione</option>								$selectProdutos							</select>						</p>					</div>					<div class='titulo-secundario' style='width:25%;float:left;'>						<p><b>Quantidade</b></p>						<p><input type='text' id='quantidade-mp' name='quantidade-mp' value='$quantidade' class='formata-numero required' style='width:90%' maxlength='10'/></p>					</div>					<div class='titulo-secundario' id='div-produtos-incluir'  style='width:12.5%; float:left;'>						<p>&nbsp;</p>						<p><input type='button' id='botao-salvar-mp' name='botao-salvar-mp' class='botao-salvar-mp' Style='width:95%' value='$textoBotaoIncAlt' alvo='$alvo' lab-mat-id='$labMatID' tipo='$tipo'/></p>					</div>					<div class='titulo-secundario' id='div-produtos-cancelar' style='width:12.5%; float:left;'>
						<p>&nbsp;</p>
						<p><input type='button' value='Cancelar' class='botao-cancelar-mp' alvo='$alvo' Style='width:95%'/></p>
					</div>
					<div class='titulo-secundario' id='div-produtos-cancelar' style='width:100%; float:left;'>";
	if ($tipo=='utilizados'){		echo "			<p><b>Justificativa</b></p>						<p><input type='text' id='justificativa-solicitacao' name='justificativa-solicitacao' value='' class='required' style='width:96.5%'/></p>";	}	echo "			</div>					<div class='bloco-estoque-$tipo'></div>
				</fieldset>			</div>			<script type='text/javascript' src='$caminhoSistema/javascript/funcoes.formatacao.js'></script>";}function excluirMaterialUtilizadoLaboratorio(){	global $dadosUserLogin;	$dataHoraAtual = "'".retornaDataHora('','Y-m-d H:i:s')."'";	$labMatID 			= $_GET['lab-mat-id'];	mpress_query("UPDATE laboratorio_materia_prima						SET Situacao_ID = 2,						Usuario_Alteracao_ID = '".$dadosUserLogin['userID']."',						Data_Alteracao = $dataHoraAtual						where Laboratorio_Materia_Prima_ID = '$labMatID'");}function salvarMaterialUtilizadoLaboratorio(){	global $dadosUserLogin, $configLaboratorio;	$dataHoraAtual = "'".retornaDataHora('','Y-m-d H:i:s')."'";	$labMatID 			= $_GET['lab-mat-id'];
	$tipo 				= $_GET['tipo'];
	$labProdID 			= $_POST['lab-prod-id'];	$produtoVariacaoID 	= $_POST['select-materia-prima'];	$quantidade 		= $_POST['quantidade-mp'];
	$justificativa 		= utf8_decode($_POST['justificativa-solicitacao']);

	if ($tipo=='utilizados')
		$quantidade = $quantidade * -1;
	if ($labMatID){		$sql = "UPDATE laboratorio_materia_prima SET Produto_Variacao_ID = '$produtoVariacaoID',													Quantidade = '$quantidade',													Usuario_Alteracao_ID = '".$dadosUserLogin['userID']."',													Data_Alteracao = $dataHoraAtual,													Justificativa = '$justificativa'
									where Laboratorio_Materia_Prima_ID = '$labMatID'";		mpress_query($sql);	}	else{		$sql = "INSERT INTO laboratorio_materia_prima					(Laboratorio_Produto_ID, Produto_Variacao_ID, Status_ID, Quantidade, Justificativa, Responsavel_ID, Data_Cadastro, Usuario_Cadastro_ID, Situacao_ID)				VALUES					('$labProdID', '$produtoVariacaoID', '176', '$quantidade', '$justificativa', '".$dadosUserLogin['userID']."', $dataHoraAtual, '".$dadosUserLogin['userID']."', 1)";		mpress_query($sql);	}	if (($tipo=='utilizados') && ($configLaboratorio['email-solicitacao-materia-prima']!='')){		$rs = mpress_query("select concat(coalesce(pd.Nome,''),' ',coalesce(pv.Descricao,'')) as Produto												from produtos_dados pd												inner join produtos_variacoes pv on pv.Produto_ID = pd.Produto_ID												where pv.Produto_Variacao_ID = '$produtoVariacaoID'");		if($row = mpress_fetch_array($rs)){			enviarEmailSolicitacaoMaterial($configLaboratorio['email-solicitacao-materia-prima'], $labProdID, $row['Produto'], $justificativa, $quantidade, $dadosUserLogin['nome'], retornaDataHora('','d/m/Y H:i'));		}	}}function enviarEmailSolicitacaoMaterial($dadosEmail, $laboratorioID, $produto, $justificativa, $quantidade, $solicitante, $dataHoraEntrada){	global $dadosUserLogin, $caminhoSistema, $tituloSistema;	$conteudoEmail = "			<table border='0' align='center' cellpadding='0' cellspacing='0'>				<tr>					<td>						<table width='735' border='0' align='center' cellpadding='5' cellspacing='0' style='font-family:Helvetica, Arial, Tahoma, Verdana, sans-serif; font-weight: normal; font-size:13px; color:#222222; margin:21px; border:0px;'>							<tr>								<td align='center' valign='top' colspan='2' style='border-bottom:1px solid #cccccc; background-color: #c9c9c9;'>								<b>Solicita&ccedil;&atilde;o de Mat&eacute;ria Prima:</b></td>							</tr>							<tr>								<td align='left' valign='top' width='160' style='border-bottom:1px solid #cccccc;'><b>Ordem Laborat&oacute;rio:</b></td>								<td align='left' valign='top' width='575' style='border-bottom:1px solid #cccccc;'>$laboratorioID</td>							</tr>							<tr>
								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'><b>Mat&eacute;ria Prima Solicitada:</b></td>
								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'>".utf8_decode($produto)."</td>
							</tr>
							<tr>
								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'><b>Justificativa:</b></td>
								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'>".utf8_decode($justificativa)."</td>
							</tr>
							<tr>								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'><b>Quantidade:</b></td>								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'>$quantidade</td>							</tr>							<tr>								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'><b>Solicitante:</b></td>								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'>$solicitante</td>							</tr>							<tr>								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'><b>Data:</b></td>								<td align='left' valign='top' style='border-bottom:1px solid #cccccc;'>$dataHoraEntrada</td>							</tr>						</table>					</td>				</tr>			</table>";	$titulo = $tituloSistema." Solicitação de Materia Prima - $produto - Ordem Laboratório: ".$laboratorioID;	echo enviaEmails($dadosEmail, $titulo, geraEmailPadrao($conteudoEmail), "<p>Envio efetuado com successo</p>");}function executarMovimentacaoLaboratorio(){	global $dadosUserLogin, $caminhoSistema;	$dataHoraAtual = "'".retornaDataHora('','Y-m-d H:i:s')."'";	$materiasPrimas = ""; $virgula = ""; unset($materiaPrimaID);	foreach($_POST['produto-aprovar'] as $chave => $materiaPrimaID){		$materiasPrimas .= $virgula.$materiaPrimaID;		$virgula = ",";		$labProdID = $_POST['lab-produto-id'][$chave];		$labMpID = $_POST['lab-mp-id'][$chave];		//$labQuant = ($_POST['lab-quant'][$chave]) * -1;		$labQuant = ($_POST['lab-quant'][$chave]);		$cdID = $_POST['retira-estoque-mp'][$chave];		$justificativa = $_POST['justificativa-mp'][$chave];		mpress_query("insert into produtos_movimentacoes (CD_ID, Chave_Estrangeira, Chave_Estrangeira_Produto, Tabela_Estrangeira, Produto_Variacao_ID, Tipo_Movimentacao_ID, Quantidade, 	Justificativa, Data_Cadastro, Usuario_Cadastro_ID)													values ($cdID, '$labProdID', 		 '$materiaPrimaID', 	 'laboratorio', 		'$labMpID', 				   67, '$labQuant', '$justificativa', $dataHoraAtual, '".$dadosUserLogin['userID']."')");	}	if ($materiasPrimas!=''){		$sql = "update laboratorio_materia_prima set Status_ID = 177,								Data_Alteracao = $dataHoraAtual ,								Usuario_Alteracao_ID = '".$dadosUserLogin['userID']."'								where Laboratorio_Materia_Prima_ID IN ($materiasPrimas)";		mpress_query($sql);	}	$materiasPrimas = ""; $virgula = ""; unset($materiaPrimaID);	foreach($_POST['produto-cancelar'] as $materiaPrimaID){		$materiasPrimas .= $virgula.$materiaPrimaID;		$virgula = ",";	}	if ($materiasPrimas!=''){		$sql = "update laboratorio_materia_prima set Status_ID = 178,								Data_Alteracao = $dataHoraAtual ,								Usuario_Alteracao_ID = '".$dadosUserLogin['userID']."'								where Laboratorio_Materia_Prima_ID IN ($materiasPrimas)";		mpress_query($sql);	}		echo "	<form method='post' action='$caminhoSistema/laboratorio/laboratorio-controle-materia-prima' name='frmAuxiliar'></form>			<script>document.frmAuxiliar.submit();</script>";
}function carregarProdutoEstoque(){	$produtoVariacaoID = $_GET['produto-variacao-id'];	$sql = "select cd.CD_ID, cd.Descricao, pm.Produto_Variacao_ID, sum(pm.Quantidade) saldoEstoque				from envios_centros_distribuicao cd  				left join produtos_movimentacoes pm on cd.CD_ID = pm.CD_ID and pm.Produto_Variacao_ID = '$produtoVariacaoID'				where cd.CD_ID > 0				group by cd.CD_ID";	$resultado = mpress_query($sql);	//echo count($resultado);	$estoque = "<br><br><table cellspacing='4' cellpadding='4' style='width:50%; border:0px solid #ccc' align='center'>";	while($rs = mpress_fetch_array($resultado)){		$estoque .= "	<tr>							<td style='width:75%; background-color: #ccc' align='center'><b>Estoque - ".utf8_encode($rs['Descricao']).": </b></td>							<td style='width:25%; background-color: #ccc' align='left'><b>".number_format($rs['saldoEstoque'], 2, ',', '.')."</b></td>						</tr>";	}	$estoque .= "</table><br>";	echo $estoque;}?>