<?php$dataInicio = $_POST['data-inicio-abertura'];$dataFim = $_POST['data-fim-abertura'];$dataInicioFinalizado = $_POST['data-inicio-finalizado'];$dataFimFinalizado = $_POST['data-fim-finalizado'];$virgula = "";for($i = 0; $i < count($_POST['localiza-vinculos-cadastros']); $i++){	$vinculosCadastros .= $virgula.$_POST['localiza-vinculos-cadastros'][$i];	$virgula = ",";}$resultado = mpress_query("select distinct cd.Cadastro_ID, cd.Nome as Nome							from cadastros_vinculos cv								inner join cadastros_dados cd on cd.Cadastro_ID = cv.Cadastro_ID and cd.Empresa <> 1								where cv.Situacao_ID = 1 and cd.Situacao_ID = 1								order by cd.Nome");$v = 0;while($row = mpress_fetch_array($resultado)){	$v++;	$arrayVinculosCadastros[$v]['value'] = $row[Cadastro_ID];	$arrayVinculosCadastros[$v]['descricao'] = $row[Nome];}echo "	<div class='titulo-container'>			<div class='titulo'>				<p>Filtros de Pesquisa <!--<input type='button' value='Incluir Novo' class='laboratorio-inc-alt' lab-prod-id=''/>--> </p>			</div>			<div class='conteudo-interno'>				<div class='titulo-secundario' style='float:left; width:10%;'>					<p>ID Laborat&oacute;rio</p>					<p><input type='text' name='localiza-laboratorio-produto-id' id='localiza-laboratorio-produto-id' class='formata-numero' value='".$_POST['localiza-laboratorio-produto-id']."' style='width:93%;'></p>				</div>				<div class='titulo-secundario' style='float:left; width:30%'>					<p>Descri&ccedil;&atilde;o Produto</p>					<p><input type='text' id='localiza-descricao-produto' name='localiza-descricao-produto' value='".$_POST['localiza-descricao-produto']."' style='width:95%'/></p>				</div>				<div class='titulo-secundario' style='float:left; width:20%'>					<p>N&uacute;mero S&eacute;rie</p>					<p><input type='text' id='localiza-numero-serie' name='localiza-numero-serie' value='".$_POST['localiza-numero-serie']."' style='width:95%'/></p>				</div>				<div class='titulo-secundario' style='float:left; width:20%'>					<p>Técnico Respons&aacute;vel</p>					<p><select name='localiza-responsavel'><option></option>".optionValueUsuarios($_POST['localiza-responsavel'],"","")."</select></p>				</div>				<div class='titulo-secundario' style='float:left; width:20%'>					<p>Situa&ccedil;&atilde;o</p>					<p><select name='localiza-situacao' id='localiza-situacao'>".optionValueGrupo(60, $_POST['localiza-situacao'], "&nbsp;")."<select></p>				</div>				<div class='titulo-secundario' style='float:left; width:20%'>					<p>Data Cadastro</p>					<div style='width:43%;float:left;'>						<p><input type='text' name='data-inicio-abertura' id='data-inicio-abertura' class='formata-data' style='width:95%' maxlength='10' value='".$dataInicio."'>&nbsp;&nbsp;</p>					</div>					<div style='width:10%;text-align:center;float:left;'><p>a</p></div>					<div style='width:43%;float:left;'>						<p><input type='text' name='data-fim-abertura' id='data-fim-abertura' class='formata-data' style='width:95%' maxlength='10' value='".$dataFim."'></p>					</div>				</div>				<div class='titulo-secundario' style='float:left; width:20%'>					<p>Data Finalizado</p>					<div style='width:43%;float:left;'>						<p><input type='text' name='data-inicio-finalizado' id='data-inicio-finalizado' class='formata-data' style='width:95%' maxlength='10' value='".$dataInicioFinalizado."'>&nbsp;&nbsp;</p>					</div>					<div style='width:10%;text-align:center;float:left;'><p>a</p></div>					<div style='width:43%;float:left;'>						<p><input type='text' name='data-fim-finalizado' id='data-fim-finalizado' class='formata-data' style='width:95%' maxlength='10' value='".$dataFimFinalizado."'></p>					</div>				</div>				<div class='titulo-secundario' style='float:left; width:20%'>					<p>Vinculados ao Cadastro</p>					<p><select name='localiza-vinculos-cadastros[]' id='localiza-vinculos-cadastros[]' multiple>".optionValueArrayMultiplo($arrayVinculosCadastros,$vinculosCadastros)."</select></p>				</div>				<!--				<div class='titulo-secundario' style='float:left; width:20%'>					<p>Origem</p>					<p><select name='localiza-responsavel'><option></option>".optionValueUsuarios($_POST['localiza-responsavel'],"","")."</select></p>				</div>				-->				<div class='titulo-secundario' style='float:left; width:10%; float:right;'>					<p><input type='button' value='Pesquisar' class='botao-pesquisar-laboratorio' style='width:90%; margin-top:15px; margin-bottom:5px; float:right;'/></p>				</div>			</div>		</div>		<input type='hidden' value='' id='lab-prod-id' name='lab-prod-id'>";	if($_POST['ordena-tabela'] != "")		$sqlOrdem = " order by ".$_POST['ordena-tabela']." ".$_POST['ordena-tipo'].", pd.Produto_ID";	else		$sqlOrdem = " order by lp.Laboratorio_Produto_ID desc";//if($_POST){	if ($_POST['localiza-laboratorio-produto-id'] != "") $sqlCond .= " and lp.Laboratorio_Produto_ID IN(".$_POST['localiza-laboratorio-produto-id'].")";	if ($_POST['localiza-descricao-produto'] != "") $sqlCond .= " and concat(pd.Nome, ' ', pv.Descricao) like '%".$_POST['localiza-descricao-produto']."%'";	if ($_POST['localiza-numero-serie'] != "") $sqlCond .= " and pm.Numero_Serie like '%".$_POST['localiza-numero-serie']."%'";	if ($_POST['localiza-responsavel'] != "") $sqlCond .= " and lp.Tecnico_Responsavel_ID in (".$_POST['localiza-responsavel'].")";	if ($_POST['localiza-situacao'] != "") $sqlCond .= " and lp.Status_ID in (".$_POST['localiza-situacao'].")";	if ($vinculosCadastros!=''){		$sqlCond .= " and lp.Origem_Cadastro_ID in (select distinct Cadastro_Filho_ID from cadastros_vinculos where Cadastro_ID in ($vinculosCadastros) and Situacao_ID = 1)";	}	if(($dataInicio!="")||($dataFim!="")){		$dataInicio = implode('-',array_reverse(explode('/',$dataInicio)));		if ($dataInicio=="") $dataInicio = "0000-00-00"; $dataInicio .= " 00:00";		$dataFim = implode('-',array_reverse(explode('/',$dataFim)));		if ($dataFim=="") $dataFim = "2100-01-01"; $dataFim .= " 23:59";		$sqlCond .= " and lp.Data_Cadastro between '$dataInicio' and '$dataFim' ";	}	if(($dataInicioFinalizado!="")||($dataFimFinalizado!="")){		$dataInicioFinalizado = implode('-',array_reverse(explode('/',$dataInicioFinalizado)));		if ($dataInicioFinalizado=="") $dataInicioFinalizado = "0000-00-00"; $dataInicioFinalizado .= " 00:00";		$dataFimFinalizado = implode('-',array_reverse(explode('/',$dataFimFinalizado)));		if ($dataFimFinalizado=="") $dataFimFinalizado = "2100-01-01"; $dataFimFinalizado .= " 23:59";		$sqlCond .= " and lp.Data_Finalizado between '$dataInicioFinalizado' and '$dataFimFinalizado'";	}	$sql = "SELECT lp.Laboratorio_Produto_ID, pm.Numero_Serie, pd.Produto_ID AS Produto_ID,					concat(coalesce(pd.Nome,''),' ',coalesce(pv.Descricao,'')) as Nome,					lp.Data_Cadastro AS Data_Cadastro, map.Nome_Arquivo AS Nome_Arquivo,					cds.Nome as Solicitante, tlp.Descr_Tipo as Status_Analise,					cdr.Nome as Tecnico_Responsavel, cdo.Nome as Origem_Cadastro,					tlp.Tipo_Auxiliar as DadosAuxTipo					from laboratorio_produtos lp				inner join produtos_variacoes pv on pv.Produto_Variacao_ID = lp.Produto_Variacao_ID				inner join produtos_dados pd ON pd.Produto_ID = pv.Produto_ID				left join tipo tlp on tlp.Tipo_ID = lp.Status_ID				left join produtos_movimentacoes pm on pm.Produto_Movimentacao_ID = lp.Produto_Movimentacao_ID				left join modulos_anexos map ON map.Anexo_ID = (SELECT MIN(mapaux.Anexo_ID) FROM modulos_anexos mapaux WHERE mapaux.Tabela_Estrangeira = 'produtos' AND mapaux.Chave_Estrangeira = pd.Produto_ID AND mapaux.Situacao_ID = 1 LIMIT 1)				left join cadastros_dados cds on cds.Cadastro_ID = lp.Usuario_Cadastro_ID				left join cadastros_dados cdr on cdr.Cadastro_ID = lp.Tecnico_Responsavel_ID				left join cadastros_dados cdo on cdo.Cadastro_ID = lp.Origem_Cadastro_ID				where pd.Situacao_ID = 1 AND pv.Situacao_ID = 1 AND pd.Produto_ID > 0 AND pv.Produto_Variacao_ID > 0			$sqlCond			$sqlOrdem";	//echo $sql;	$resultado = mpress_query($sql);	while($row = mpress_fetch_array($resultado)){		$i++;		$dadosSit = unserialize($row['DadosAuxTipo']);		$tecnicoResponsavel = "";		if ($row['Tecnico_Responsavel']!="")			$tecnicoResponsavel = $row['Tecnico_Responsavel'];		$nomeArquivo = $caminhoSistema."/images/geral/imagem-produto.jpg";		if ($row[Nome_Arquivo]!="") $nomeArquivo = $caminhoSistema."/uploads/".$row[Nome_Arquivo];		$dados[colunas][tr][$i] = " style='font-weight:bold; cursor:pointer;' class='lnk laboratorio-inc-alt' lab-prod-id='".$row[Laboratorio_Produto_ID]."'";		$dados[colunas][conteudo][$i][1] = "<p Style='margin:2px 5px 0 5px;float:left;'>".$row[Laboratorio_Produto_ID]."</p>";		$dados[colunas][conteudo][$i][2] = "<p Style='margin:2px 0 0 5px;float:left;'><a href='$nomeArquivo' class='fancybox' rel='fancybox'><img style='max-width:20px; max-height:20px;' src='$nomeArquivo'></a> ".$row[Nome]."</p>";		$dados[colunas][conteudo][$i][3] = "<p Style='margin:2px 0 0 5px;float:left;'>".$row[Numero_Serie]."</p>";		$dados[colunas][conteudo][$i][4] = "<p Style='margin:2px 0 0 5px;float:left;'>".$tecnicoResponsavel."</p>";		$dados[colunas][conteudo][$i][5] = "<p Style='margin:2px 0 0 5px;float:left;'>".$row[Origem_Cadastro]."</p>";		$dados[colunas][extras][$i][6] = " style='color:".$dadosSit['cor-texto']."; background-color:".$dadosSit['cor-fundo']."'";		$dados[colunas][conteudo][$i][6] = "<p Style='margin:2px 0 0 5px;float:left;'>".$row[Status_Analise]."</p>";		$dados[colunas][conteudo][$i][7] = $row[Solicitante];		$dados[colunas][conteudo][$i][8] = "<center>".substr(converteData($row[Data_Cadastro],1),0,10)."</center>";	}	if($i==0){		echo "<p Style='margin:2px 5px 0 5px;color:red; text-align:center'>Nenhum registro localizado</p>";	}	else{		$largura = "100.2%";		$colunas = "7";		$dados[colunas][tamanho][1] = "width='50px'";		$dados[colunas][tamanho][2] = "";		$dados[colunas][tamanho][3] = "";		$dados[colunas][tamanho][4] = "";		$dados[colunas][tamanho][5] = "";		$dados[colunas][tamanho][6] = "";		$dados[colunas][tamanho][7] = "width='90px'";		$dados[colunas][titulo][1] 	= "ID Lab.";		$dados[colunas][titulo][2] 	= "Produto";		$dados[colunas][titulo][3] 	= "Número Série";		$dados[colunas][titulo][4] 	= "Técnico Responsável";		$dados[colunas][titulo][5] 	= "Origem";		$dados[colunas][titulo][6] 	= "Situação";		$dados[colunas][titulo][7] 	= "Usuário Cadastro";		$dados[colunas][titulo][8] 	= "<center>Data Cadastro</center>";		$dados[colunas][ordena][1] = " lp.Laboratorio_Produto_ID";		$dados[colunas][ordena][2] = " pd.Produto_ID";		$dados[colunas][ordena][3] = " pm.Numero_Serie";		$dados[colunas][ordena][4] = " Tecnico_Responsavel";		$dados[colunas][ordena][5] = " Origem ";		$dados[colunas][ordena][6] = " Status_Analise";		$dados[colunas][ordena][7] = " Solicitante";		$dados[colunas][ordena][8] = " lp.Data_Cadastro";		echo "	<div class='titulo-container'>					<div class='titulo'>						<p>Registros encontrados: $i</p>					</div>					<div class='conteudo-interno'>";		geraTabela($largura, $colunas, $dados, '', 'laboratorio-localiza', 2, 2, 100,1);		echo "		</div>				</div>";	}//}
?>
