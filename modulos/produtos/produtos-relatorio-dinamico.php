<?php	$dadospagina = get_page_content();	//require_once("functions.php");	localizaCadastros();	function localizaCadastros(){			$codigo = $_POST['localiza-produto-codigo'];			$tipoProdutoID = $_POST['localiza-tipo-produto'];			$descricao = $_POST['localiza-descricao-produto'];			$fornecedor = $_POST['localiza-fornecedor'];			$formaCobranca = $_POST['localiza-forma-cobranca'];			if ($codigo != ""){ $sqlCond .= " and pv.Codigo = $codigo ";}			if ($tipoProdutoID != ""){ $sqlCond .= " and pd.Tipo_Produto = $tipoProdutoID ";}			if ($formaCobranca != ""){ $sqlCond .= " and pv.Forma_Cobranca_ID = $formaCobranca ";}			if ($descricao != ""){ $sqlCond .= " and (concat(coalesce(pd.Nome,''),' ',coalesce(pv.Descricao,'')) like '%$descricao%' or pd.Descricao_Resumida like '%$descricao%')";}			if ($fornecedor != ""){ $sqlCond .= " and pd.Produto_ID IN (Select Produto_ID from produtos_fornecedores pf inner join cadastros_dados c on c.Cadastro_ID = pf.Cadastro_ID where Nome like '%$fornecedor%')";}			if($_POST['ordena-tabela'] != "")				$sqlOrdem = "   ".$_POST['ordena-tabela']." ".$_POST['ordena-tipo'].", pd.Produto_ID";			else				$sqlOrdem = " order by Tipo_Produto, Nome, Produto_ID ";			$sql = "select pd.Produto_ID as Produto_ID, pv.Codigo, concat(coalesce(pd.Nome,''),' ',coalesce(pv.Descricao,'')) as Nome, Descricao_Resumida, Descricao_Completa, Tipo_Produto, tp.Descr_Tipo as Tipo,						pv.Valor_Custo, pv.Valor_Venda, pv.Forma_Cobranca_ID, pv.Percentual_Venda,						pv.Altura, pv.Largura, pv.Comprimento, pv.Peso, count(pf.Produto_ID) as Qtd_Fornecedor, pd.NCM, m.Descr_Tipo as Marca_Descricao					from produtos_dados pd					left join produtos_variacoes pv on pd.Produto_ID = pv.Produto_ID					left join tipo tp on tp.Tipo_ID = pd.Tipo_Produto and tp.Tipo_Grupo_ID = 13					left join produtos_fornecedores pf on pf.Produto_ID = pd.Produto_ID and pf.Situacao_ID = 1
					left join tipo m on m.Tipo_ID = pd.Marca
					where pd.Situacao_ID = 1 and pv.Situacao_ID = 1					$sqlCond					group by pd.Produto_ID, pv.Codigo, pd.Nome, pv.Descricao, Descricao_Resumida, Descricao_Completa, Tipo_Produto, pd.Marca, tp.Descr_Tipo, pv.Descricao,						Valor_Custo, Valor_Venda, Forma_Cobranca_ID, Percentual_Venda,						Altura, Largura, Comprimento, Peso					$sqlOrdem";			//echo $sql;			echo "	<div id='cadastros-container'>						<div class='titulo-container'>							<div class='titulo'>								<p>Filtros de Pesquisa								<input type='button' value='Incluir Novo' class='produto-localiza' produto-id='' style='float:right;height:24px;font-size:10px;margin-top:-3px;width:120px;'>								</p>							</div>							<div class='conteudo-interno'>								<div class='titulo-secundario' style='float:left; width:10%'>									<p>C&oacute;digo</p>									<p><input type='text' id='localiza-produto-codigo' name='localiza-produto-codigo' value='".$codigo."' style='width:90%'/></p>									<input type='hidden' id='produto-id' name='produto-id' value=''/>								</div>								<div class='titulo-secundario' style='float:left; width:15%'>									<p>Tipo</p>									<p><select id='localiza-tipo-produto' name='localiza-tipo-produto'>".optionValueGrupo(13, $tipoProdutoID,"&nbsp;")."</select></p>								</div>								<div class='titulo-secundario' style='float:left; width:15%'>									<p>Forma Pagamento</p>									<p><select id='localiza-forma-cobranca' name='localiza-forma-cobranca'>".optionValueGrupo(20, $formaCobranca,"&nbsp;")."</select></p>								</div>								<div class='titulo-secundario' style='float:left; width:30%'>									<p>Descri&ccedil;&atilde;o Produto</p>									<p><input type='text' id='localiza-descricao-produto' name='localiza-descricao-produto' value='".$descricao."' style='width:95%'/></p>								</div>								<div class='titulo-secundario' style='float:left; width:20%'>									<p>Fornecedor</p>									<p><input type='text' id='localiza-fornecedor' name='localiza-fornecedor' value='".$fornecedor."' style='width:90%'/></p>								</div>								<div class='titulo-secundario' style='float:left; width:10%'>									<p class='direita'><input type='button' value='Pesquisar' id='botao-pesquisar-produtos' style='width:90%; margin-top:14px'/></p>								</div>							</div>						</div>					</div><input type='hidden' id='cadastroID' name='cadastroID' value=''>";			if($_POST){				$resultado = mpress_query($sql);				while($row = mpress_fetch_array($resultado)){					$i++;					$nome = $row[Nome];					$valorCusto = number_format($row[Valor_Custo],2, ',', '.');					$valorVenda = number_format($row[Valor_Venda],2, ',', '.');					$altura = ""; $largura = ""; $comprimento = ""; $peso = "";					if (($row[Tipo_Produto]==30)||($row[Tipo_Produto]==58)){						$altura = number_format($row[Altura],2, ',', '.');						$largura = number_format($row[Largura],2, ',', '.');						$comprimento = number_format($row[Comprimento],2, ',', '.');						$peso = number_format($row[Peso],2, ',', '.');					}					if ($row[Forma_Cobranca_ID]==36){						$valorCusto = "ABERTO";						$valorVenda = number_format($row[Percentual_Venda],2, ',', '.')." %";					}					$dados[colunas][conteudo][$i][1] = "<p Style='margin:2px 5px 0 5px;float:left;' class='link produto-localiza' produto-id='".$row[Produto_ID]."'>".$row[Codigo]."</p>";
					$dados[colunas][conteudo][$i][2] = "<p Style='margin:2px 5px 0 5px;float:left;' class='link produto-localiza' produto-id='".$row[Produto_ID]."'>".$nome."</p>";					$dados[colunas][conteudo][$i][3] = "<p Style='margin:2px 5px 0 5px;float:left;'>".$row[Tipo]."</p>";					$dados[colunas][conteudo][$i][4] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$altura."</p>";					$dados[colunas][conteudo][$i][5] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$largura."</p>";					$dados[colunas][conteudo][$i][6] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$comprimento."</p>";					$dados[colunas][conteudo][$i][7] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$peso."</p>";					$dados[colunas][conteudo][$i][8] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$valorCusto."</p>";					$dados[colunas][conteudo][$i][9] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$valorVenda."</p>";					$dados[colunas][conteudo][$i][10] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$row['Qtd_Fornecedor']."</p>";
					$dados[colunas][conteudo][$i][11] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$row['Marca_Descricao']."</p>";
					$dados[colunas][conteudo][$i][12] = "<p Style='margin:2px 5px 0 5px;float:right;'>".$row['NCM']."</p>";

				}				if($i==0){					echo "<p Style='margin:2px 5px 0 5px;color:red; text-align:center'>Nenhum cadastro localizado</p>";				}				else{					$largura = "100.2%";					$colunas = "12";					$dados[colunas][tamanho][1] = "width='10%'";					$dados[colunas][titulo][1] 	= "C&oacute;digo";					$dados[colunas][titulo][2] 	= "Nome";					$dados[colunas][titulo][3] 	= "Tipo";					$dados[colunas][titulo][4] 	= "<p Style='margin:2px 5px 0 5px;float:right;'>Altura (cm)</p>";					$dados[colunas][titulo][5] 	= "<p Style='margin:2px 5px 0 5px;float:right;'>Largura (cm)</p>";					$dados[colunas][titulo][6] 	= "<p Style='margin:2px 5px 0 5px;float:right;'>Comprimento (cm)</p>";					$dados[colunas][titulo][7] 	= "<p Style='margin:2px 5px 0 5px;float:right;'>Peso (gramas)</p>";					$dados[colunas][titulo][8] 	= "<p Style='margin:2px 5px 0 5px;float:right;'>Valor Custo</p>";					$dados[colunas][titulo][9] 	= "<p Style='margin:2px 5px 0 5px;float:right;'>Valor Venda</p>";					$dados[colunas][titulo][10] = "<p Style='margin:2px 5px 0 5px;float:right;'>Qtd. Forn.</p>";
					$dados[colunas][titulo][11] = "<p Style='margin:2px 5px 0 5px;float:right;'>Marca</p>";
					$dados[colunas][titulo][12] = "<p Style='margin:2px 5px 0 5px;float:right;'>NCM</p>";
					geraTabela($largura,$colunas,$dados, null, 'produtos-relatorio-dinamico', 2, 2, 100,1);				}			}	}